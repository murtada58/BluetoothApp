<!DOCTYPE html>
  <html>
    <head>
      <title>Getting Started with p5.ble.js</title>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.dom.min.js"></script>
      <script src="https://unpkg.com/p5ble@0.0.4/dist/p5.ble.js"></script>
    </head>

    <body>
        <button onclick="connectToBle()">connect</button>
        <button onclick="sendData('LED OFF\n')">send</button>
      <script>
      const serviceUuid = "0000ffe0-0000-1000-8000-00805f9b34fb";
      let myCharacteristic;
      let myValue = 0;
      let myBLE;
      let isConnected = false;
      myBLE = new p5ble();

      function connectToBle() {
        // Connect to a device by passing the service UUID
        myBLE.connect(0xFFE0, gotCharacteristics);
      }

      // A function that will be called once got characteristics
      function gotCharacteristics(error, characteristics) {
        if (error) console.log('error: ', error);
        console.log('characteristics: ', characteristics);
        myCharacteristic = characteristics[0];

        myBLE.startNotifications(myCharacteristic, gotValue, 'string');
        isConnected = true
        myBLE.onDisconnected(onDisconnected)
      }

      // A function that will be called once got values
      function gotValue(error, value) {
        if (error) console.log('error: ', error);
        console.log('value: ', value);
      }

      function onDisconnected()
      {
          console.log("disconncted");
          isConnected = false;
      }

      function sendData(command)
      {
          console.log(command)
          const inputValue = command;
          if (!("TextEncoder" in window))
          {
              console.log("browser does not support text encoder try chrome")
          }
        var enc = new TextEncoder();
        myCharacteristic.writeValue(enc.encode(inputValue));
      }
      </script>
    </body>
  </html>